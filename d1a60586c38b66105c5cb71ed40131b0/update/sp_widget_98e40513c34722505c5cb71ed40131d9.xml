<?xml version="1.0" encoding="UTF-8"?><record_update table="sp_widget">
    <sp_widget action="INSERT_OR_UPDATE">
        <category>custom</category>
        <client_script><![CDATA[api.controller=function($rootScope) {
  /* widget controller */
  var c = this;
	
	$rootScope.$on('dateSelect',function(event,data){	
		var selectedDate = data;
		var dates = selectedDate.toString();
		var parts = dates.split(" ");
		var monthMap = {
  			Jan: "01", Feb: "02", Mar: "03", Apr: "04",
  			May: "05", Jun: "06", Jul: "07", Aug: "08",
  			Sep: "09", Oct: "10", Nov: "11", Dec: "12"
		};
		var day = parts[2];
		var month = monthMap[parts[1]];
		var year = parts[3];
		var dateStr = year + "-" + month + "-" + day;
		var query = "departure_timeON" + dateStr +
        "@javascript:gs.dateGenerate('" + dateStr + "','start')" +
        "@javascript:gs.dateGenerate('" + dateStr + "','end')"; 
		c.data.query=query;
     c.server.update().then(function(){
         
      });
	});
	
	$rootScope.$on('loc1',function(event,data){
		 c.data.deplocation=data;
     c.server.update().then(function(){      
      });
	});
	
	$rootScope.$on('loc2',function(event,data){
		 c.data.deslocation=data;
     c.server.update().then(function(){
      });
	});
	
	
	
};]]></client_script>
        <controller_as>c</controller_as>
        <css>.card-container {
  display: flex;
  flex-wrap: wrap;
  gap: 24px;
  padding: 20px;
  justify-content: flex-start;
}

.card {
  background-color: #ffffff;
  border-radius: 16px;
  padding: 24px;
  width: 320px;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
  transition: transform 0.2s ease, box-shadow 0.3s ease;
  display: flex;
  flex-direction: column;
  justify-content: space-between;
}

.card:hover {
  transform: translateY(-4px);
  box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
}

.ride-id a {
  font-size: 20px;
  font-weight: 600;
  color: #007BFF;
  text-decoration: none;
  transition: color 0.3s;
}

.ride-id a:hover {
  color: #0056b3;
  text-decoration: underline;
}

.ride-info p {
  margin: 8px 0;
  font-size: 15px;
  color: #444;
  line-height: 1.5;
}

.ride-info strong {
  color: #222;
}
</css>
        <data_table>sp_instance</data_table>
        <demo_data/>
        <description/>
        <docs/>
        <field_list/>
        <has_preview>true</has_preview>
        <id>rides</id>
        <internal>false</internal>
        <link><![CDATA[function link(scope, element, attrs, controller) {
  
}]]></link>
        <name>Rides</name>
        <option_schema/>
        <public>false</public>
        <roles/>
        <script><![CDATA[(function() {
  /* populate the 'data' object */
  /* e.g., data.table = $sp.getValue('table'); */
	
	var obj = {};
	var grRRQ = new GlideRecord("x_1633452_smrt_ri_ride_requests");
	grRRQ.addEncodedQuery("stateNOT IN3,4");
	grRRQ.query();
	while(grRRQ.next()){
		var rideSchedule = grRRQ.getValue('ride_schedule');
		if(obj[rideSchedule]){
			obj[rideSchedule]++;
		}else{
			obj[rideSchedule]=1;
		}
	}
	
//gs.addInfoMessage("INFO"+JSON.stringify(obj));
	
	
	data.rides = [];
	var grRide = new GlideRecord('x_1633452_smrt_ri_ride_schedules');
	if(input && input.deplocation){
		grRide.addQuery("departing_location",input.deplocation);
	}
	if(input && input.deslocation){
		grRide.addQuery("destination_location",input.deslocation);
	}
	if(input && input.query){
		grRide.addEncodedQuery(input.query);
	}
  grRide.query();
	while(grRide.next()){
		var json = {}
		json.number = grRide.getDisplayValue('number');
		json.ride_provider = grRide.getDisplayValue('ride_provider');
		json.phone = grRide.getDisplayValue('ride_provider.mobile_phone');
		json.departing_location = grRide.getDisplayValue('departing_location');
		json.destination_location = grRide.getDisplayValue('destination_location');
		json.departure_time = grRide.getDisplayValue('departure_time');
		json.pickup_point = grRide.getDisplayValue('pickup_point');
		json.vehicle_type = grRide.getDisplayValue('vehicle_type');
		json.sys_id = grRide.getValue('sys_id');
	if((obj[grRide.getValue('sys_id')]<grRide.getValue('available_seats'))||(!obj[grRide.getValue('sys_id')]))
		data.rides.push(json);
	}
	
	

})();]]></script>
        <servicenow>false</servicenow>
        <sys_class_name>sp_widget</sys_class_name>
        <sys_created_by>admin</sys_created_by>
        <sys_created_on>2025-08-04 07:20:04</sys_created_on>
        <sys_id>98e40513c34722505c5cb71ed40131d9</sys_id>
        <sys_mod_count>75</sys_mod_count>
        <sys_name>Rides</sys_name>
        <sys_package display_value="Smart Ride Connect" source="x_1633452_smrt_ri">d1a60586c38b66105c5cb71ed40131b0</sys_package>
        <sys_policy/>
        <sys_scope display_value="Smart Ride Connect">d1a60586c38b66105c5cb71ed40131b0</sys_scope>
        <sys_update_name>sp_widget_98e40513c34722505c5cb71ed40131d9</sys_update_name>
        <sys_updated_by>admin</sys_updated_by>
        <sys_updated_on>2025-08-07 06:25:11</sys_updated_on>
        <template><![CDATA[<div class="card-container">
  <div class="card" ng-repeat="key in data.rides">
    <h3 class="ride-id">
      <a href="?id=sc_cat_item&sys_id=ff401193c38722505c5cb71ed40131c5&ride_schedule={{key.sys_id}}">
        {{key.number}}
      </a>
    </h3>
    <div class="ride-info">
      <p><strong>Ride Provider:</strong> {{key.ride_provider}}</p>
      <p><strong>Phone:</strong> {{key.phone}}</p>
      <p><strong>Departure Location:</strong> {{key.departing_location}}</p>
      <p><strong>Destination Location:</strong> {{key.destination_location}}</p>
      <p><strong>Departure Time:</strong> {{key.departure_time}}</p>
      <p><strong>Vehicle Type:</strong> {{key.vehicle_type}}</p>
      <p><strong>Pickup Point:</strong> {{key.pickup_point}}</p>
    </div>
  </div>
</div>


]]></template>
    </sp_widget>
</record_update>
